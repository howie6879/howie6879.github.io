<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta name="generator" content="Hugo 0.110.0">
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="配置 # 对于一个项目来说，配置是一个很严肃的问题，比如说：在开发环境和生产环境中，配置是不同的，那么一个项目该如何自由地在不同的配置环境中进行切换呢，思考下，然后带着答案或者疑问往下阅读。
单一配置 # 撸起袖子，开始吧，新建文件夹 demo2 ，内部建立这样的文件结构：
demo02 ├── config │ ├── __init__.py │ └── config.py └── run.py 其中 run.py 内容如下：
#!/usr/bin/env python from sanic import Sanic from sanic.response import text app = Sanic() @app.route(&#34;/&#34;) async def test(request): return text(&#39;Hello World!&#39;) if __name__ == &#34;__main__&#34;: app.run(host=&#34;0.0.0.0&#34;, port=8000, debug=True) 代码示例中开启了 debug 模式，假设我们需要通过 config.py 配置文件来实现控制服务的 debug 模式开启与否，那该怎么实现呢。
在 config.py 中添加一行：DEBUG=True ，然后 run.py 内容改为：
#!/usr/bin/env python from sanic import Sanic from sanic.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="配置 # 对于一个项目来说，配置是一个很严肃的问题，比如说：在开发环境和生产环境中，配置是不同的，那么一个项目该如何自由地在不同的配置环境中进行切换呢，思考下，然后带着答案或者疑问往下阅读。
单一配置 # 撸起袖子，开始吧，新建文件夹 demo2 ，内部建立这样的文件结构：
demo02 ├── config │ ├── __init__.py │ └── config.py └── run.py 其中 run.py 内容如下：
#!/usr/bin/env python from sanic import Sanic from sanic.response import text app = Sanic() @app.route(&#34;/&#34;) async def test(request): return text(&#39;Hello World!&#39;) if __name__ == &#34;__main__&#34;: app.run(host=&#34;0.0.0.0&#34;, port=8000, debug=True) 代码示例中开启了 debug 模式，假设我们需要通过 config.py 配置文件来实现控制服务的 debug 模式开启与否，那该怎么实现呢。
在 config.py 中添加一行：DEBUG=True ，然后 run.py 内容改为：
#!/usr/bin/env python from sanic import Sanic from sanic." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.howie6879.com/sanic_book/docs/01_skill/2.%E9%85%8D%E7%BD%AE/" /><meta property="article:section" content="docs" />


<title>2.配置 | Sanic-For-Pythoneer</title>
<link rel="manifest" href="/sanic_book/manifest.json">
<link rel="icon" href="/sanic_book/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/sanic_book/book.min.e935e20bd0d469378cb482f0958edf258c731a4f895dccd55799c6fbc8043f23.css" integrity="sha256-6TXiC9DUaTeMtILwlY7fJYxzGk&#43;JXczVV5nG&#43;8gEPyM=">
<script defer src="/sanic_book/en.search.min.af51d5596772464e8ed56a7194e27e848205a400b2523c4b4018f5772af80a04.js" integrity="sha256-r1HVWWdyRk6O1WpxlOJ&#43;hIIFpACyUjxLQBj1dyr4CgQ="></script>
<style>

  img[src$='#center']
  {
      display: block;
      margin: 0.7rem auto;  
       
  }
  
  img[src$='#floatleft']
  {
      float:left;
      margin: 0.7rem;       
       
  }
  
  img[src$='#floatright']
  {
      float:right;
      margin: 0.7rem;       
       
  }
  </style>
  
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/sanic_book"><span>Sanic-For-Pythoneer</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>






  
<ul>
  
  <li>
    <a href="https://www.howie6879.cn/" target="_blank" rel="noopener">
        老胡的储物柜
      </a>
  </li>
  
  <li>
    <a href="https://cdn.jsdelivr.net/gh/howie6879/oss/uPic/wechat_howie.png" target="_blank" rel="noopener">
        微信公众号
      </a>
  </li>
  
  <li>
    <a href="https://github.com/howie6879" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>







  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>第一部分：技巧</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/01_skill/1.%E5%88%9D%E4%BD%BF%E7%94%A8/" class="">1.初使用</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/01_skill/2.%E9%85%8D%E7%BD%AE/" class=" active">2.配置</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/01_skill/3.%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/" class="">3.项目结构</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/01_skill/4.%E5%B1%95%E7%A4%BA%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2/" class="">4.展示一个页面</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/01_skill/5.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8/" class="">5.数据库使用</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/01_skill/6.%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8A%80%E5%B7%A7/" class="">6.常用的技巧</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/01_skill/7.%E5%8F%AF%E9%9D%A0%E7%9A%84%E6%89%A9%E5%B1%95/" class="">7.可靠的扩展</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/01_skill/8.%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%83%A8%E7%BD%B2/" class="">8.测试与部署</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>第二部分：附录</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/02_appendix/Sanic%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E5%9F%BA%E4%BA%8E0.1.2/" class="">Sanic源码阅读：基于0.1.2</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.howie6879.com/sanic_book/docs/02_appendix/%E5%85%B3%E4%BA%8E%E8%A3%85%E9%A5%B0%E5%99%A8/" class="">关于装饰器</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/sanic_book/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>2.配置</strong>

  <label for="toc-control">
    
    <img src="/sanic_book/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#配置">配置</a>
      <ul>
        <li><a href="#单一配置">单一配置</a></li>
        <li><a href="#多配置">多配置</a></li>
        <li><a href="#说明">说明</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h2 id="配置">
  配置
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae">#</a>
</h2>
<p>对于一个项目来说，配置是一个很严肃的问题，比如说：在开发环境和生产环境中，配置是不同的，那么一个项目该如何自由地在不同的配置环境中进行切换呢，思考下，然后带着答案或者疑问往下阅读。</p>
<h3 id="单一配置">
  单一配置
  <a class="anchor" href="#%e5%8d%95%e4%b8%80%e9%85%8d%e7%bd%ae">#</a>
</h3>
<p>撸起袖子，开始吧，新建文件夹 <code>demo2</code> ，内部建立这样的文件结构：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>demo02
</span></span><span style="display:flex;"><span>├── config
</span></span><span style="display:flex;"><span>│   ├── __init__.py
</span></span><span style="display:flex;"><span>│   └── config.py
</span></span><span style="display:flex;"><span>└── run.py
</span></span></code></pre></div><p>其中 <code>run.py</code> 内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sanic <span style="color:#f92672">import</span> Sanic
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sanic.response <span style="color:#f92672">import</span> text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Sanic()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> text(<span style="color:#e6db74">&#39;Hello World!&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0.0.0.0&#34;</span>, port<span style="color:#f92672">=</span><span style="color:#ae81ff">8000</span>, debug<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p>代码示例中开启了 <code>debug</code> 模式，假设我们需要通过 <code>config.py</code> 配置文件来实现控制服务的 <code>debug</code> 模式开启与否，那该怎么实现呢。</p>
<p>在 <code>config.py</code> 中添加一行：<code>DEBUG=True</code> ，然后 <code>run.py</code> 内容改为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sanic <span style="color:#f92672">import</span> Sanic
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sanic.response <span style="color:#f92672">import</span> text
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> config <span style="color:#f92672">import</span> DEBUG
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Sanic()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> text(<span style="color:#e6db74">&#39;Hello World!&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0.0.0.0&#34;</span>, port<span style="color:#f92672">=</span><span style="color:#ae81ff">8000</span>, debug<span style="color:#f92672">=</span>DEBUG)
</span></span></code></pre></div><p>表面上看，功能确实实现了，但这实际上却不是很好的做法，若部署在生产环境中，难道还要特地再将 <code>debug</code> 改为 <code>False</code> 么，这显然很浪费时间，如果需要改变的参数有很多，那就很难维护了。</p>
<h3 id="多配置">
  多配置
  <a class="anchor" href="#%e5%a4%9a%e9%85%8d%e7%bd%ae">#</a>
</h3>
<p>那么，正确的做法应该是怎么样的呢？</p>
<p>我们应当依据不同的环境来编写各自对应的环境，举个例子，比如生产环境就对应<code>pro_config</code>，开发环境就对应<code>dev_config.py</code>等等</p>
<p>具体该怎么实施？首先在文件夹 <code>demo2</code> ，内部建立这样的文件结构：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>demo02
</span></span><span style="display:flex;"><span>├── config
</span></span><span style="display:flex;"><span>│   ├── __init__.py
</span></span><span style="display:flex;"><span>│   ├── config.py
</span></span><span style="display:flex;"><span>│   ├── dev_config.py
</span></span><span style="display:flex;"><span>│   └── pro_config.py
</span></span><span style="display:flex;"><span>└── run.py
</span></span></code></pre></div><p>然后使用类继承的方式使这三个配置文件联系起来，比如在 <code>config.py</code> 中就只放公有配置，如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Config</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Basic config for demo02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Application config</span>
</span></span><span style="display:flex;"><span>    TIMEZONE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Asia/Shanghai&#39;</span>
</span></span><span style="display:flex;"><span>    BASE_DIR <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(__file__))
</span></span></code></pre></div><p>而在 <code>pro_config.py或dev_config.py</code> 中就可以自由地编写不同的配置了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># dev_config</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> .config <span style="color:#f92672">import</span> Config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DevConfig</span>(Config):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Dev config for demo02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Application config</span>
</span></span><span style="display:flex;"><span>    DEBUG <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pro_config</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> .config <span style="color:#f92672">import</span> Config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProConfig</span>(Config):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Pro config for demo02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Application config</span>
</span></span><span style="display:flex;"><span>    DEBUG <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span></code></pre></div><p>配置文件还需要根据系统环境变量的设置进行不同配置环境的切换，比如设置 <code>MODE</code> 系统环境变量，这里从系统环境变量得到配置也是个不错的方法，一般说利用<code>gunicorn</code>配置<code>worker</code>数目之类的，都可以使用这种方案。</p>
<p>然后可以根据其不同的值切换到不同的配置文件，因此在 <code>__init__.py</code> 中需要这么写：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_config</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Load a config class
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    mode <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;MODE&#39;</span>, <span style="color:#e6db74">&#39;DEV&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;PRO&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">from</span> .pro_config <span style="color:#f92672">import</span> ProConfig
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> ProConfig
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;DEV&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">from</span> .dev_config <span style="color:#f92672">import</span> DevConfig
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> DevConfig
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">from</span> .dev_config <span style="color:#f92672">import</span> DevConfig
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> DevConfig
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ImportError</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">from</span> .config <span style="color:#f92672">import</span> Config
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CONFIG <span style="color:#f92672">=</span> load_config()
</span></span></code></pre></div><p>默认 <code>MODE</code> 设置为 <code>DEV</code>，在 <code>run.py</code> 文件中就可以这么调用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sanic <span style="color:#f92672">import</span> Sanic
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sanic.response <span style="color:#f92672">import</span> text
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> config <span style="color:#f92672">import</span> CONFIG
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Sanic()
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>config<span style="color:#f92672">.</span>from_object(CONFIG)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> text(<span style="color:#e6db74">&#39;Hello World!&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0.0.0.0&#34;</span>, port<span style="color:#f92672">=</span><span style="color:#ae81ff">8000</span>, debug<span style="color:#f92672">=</span>app<span style="color:#f92672">.</span>config[<span style="color:#e6db74">&#39;DEBUG&#39;</span>])
</span></span></code></pre></div><p>而在生产环境的服务器上，直接通过设置系统变量就可以达到配置修改的目的了，如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 通过设置MODE的值进行配置文件的选择</span>
</span></span><span style="display:flex;"><span>export MODE<span style="color:#f92672">=</span>PRO 
</span></span></code></pre></div><p>若是利用 <code>supervisor</code> 来启动服务，可通过添加<code>environment = MODE=&quot;PRO&quot;</code> 来设置环境变量，是不是很方便呢。</p>
<h3 id="说明">
  说明
  <a class="anchor" href="#%e8%af%b4%e6%98%8e">#</a>
</h3>
<p>其实我编写这种微服务，配置更新是很正常且很频繁的需求，这样的话我就必须要求我的代码可以实现热更新，也就是可以迅速的修改配置，且迅速的生效，目前我使用的是<code>ZooKeeper</code>来实现这个需求，有兴趣的朋友可以详细了解，或许你也是用这个方案呢？</p>
<p>如果你有更好的方案，不妨告知一二。</p>
<p><img src="https://cdn.jsdelivr.net/gh/howie6879/oss/uPic/qrcode_for_gh_3f02ace79dfb_258.jpg#center" alt="老胡的储物柜" /></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
<div class="guide-links">
    
    
    </div>
      </footer>

      
  
  <div class="book-comments">

<footer>
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://www.howie6879.cn/css/gitalk.css?v=0.0.0">
    <script src="https://www.howie6879.cn/js/gitalk.min.js?v=0.0.0"></script>
    <script>
        var gitalk = new Gitalk({
            clientID: '2c38ed8e7f85da0f1510',
            clientSecret: '1984f14456cb1a999dde013ec6a3e6123a92d59a',
            repo: 'howie6879.github.io',
            owner: 'howie6879',
            admin: ['howie6879'],
            id: location.pathname.substr(0, 48), 
            distractionFreeMode: false 
        })

        gitalk.render('gitalk-container')
    </script>
</footer></div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#配置">配置</a>
      <ul>
        <li><a href="#单一配置">单一配置</a></li>
        <li><a href="#多配置">多配置</a></li>
        <li><a href="#说明">说明</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>

</html>












